<ol class="breadcrumb breadcrumb-arrow font-trirong">
  <li><a href="javascript://" [routerLink]="['/']">Admin</a></li>
  <li><a href="javascript://">Data Import </a></li>
</ol>





<div class="button-bar">

  <span class="spacer"></span>
  <button class="btn btn-sm btn-primary" (click)="reset()">Reset</button>

  <button class="btn btn-sm btn-primary" (click)="changeToHorizonTal()"
    *ngIf="layout.direction === 'vertical'">HorizonTal Layout</button>
  <button class="btn btn-sm btn-primary" (click)="changeToVertical()" *ngIf="layout.direction === 'horizontal'">Vertical
    Layout</button>

</div>

<div class="clr-row">
  <div [class]="layout.block1">
    <div class="card">
      <div class="card-header">
        <div class="clr-row">
          <div class="clr-col-6">
            <h3 style="text-align: right;"> Data Import</h3>
          </div>
          <div class="clr-col-6" style="text-align: right;" *ngIf="timelineStyle.step4.open">
            <button type="button" class="btn text-dark" (click)="getSheet(id)">Download File</button>
          </div>
        </div>

        <div class=" card-block container">

          <clr-timeline [clrLayout]="layout.direction">
            <clr-timeline-step [clrState]="timelineStyle.step0.state">
              <clr-timeline-step-header>Step 0</clr-timeline-step-header>
              <clr-timeline-step-title> <span>Review</span> </clr-timeline-step-title>
            </clr-timeline-step>

            <clr-timeline-step [clrState]="timelineStyle.step1.state">
              <clr-timeline-step-header>Step 1</clr-timeline-step-header>
              <clr-timeline-step-title> <span> Table Mapping </span></clr-timeline-step-title>
            </clr-timeline-step>

            <clr-timeline-step class="gemini-ignore" [clrState]="timelineStyle.step2.state">
              <clr-timeline-step-header>Step 2</clr-timeline-step-header>
              <clr-timeline-step-title> <span> Data Mapping </span></clr-timeline-step-title>
            </clr-timeline-step>

            <clr-timeline-step [clrState]="timelineStyle.step3.state">
              <clr-timeline-step-header>Step 3</clr-timeline-step-header>
              <clr-timeline-step-title><span>Import</span></clr-timeline-step-title>

            </clr-timeline-step>
            <clr-timeline-step [clrState]="timelineStyle.step4.state">
              <clr-timeline-step-header>Step 4</clr-timeline-step-header>
              <clr-timeline-step-title>Download Excel</clr-timeline-step-title>

            </clr-timeline-step>
            <clr-timeline-step [clrState]="timelineStyle.step5.state">
              <clr-timeline-step-header>Step 5</clr-timeline-step-header>
              <clr-timeline-step-title>Finish</clr-timeline-step-title>

            </clr-timeline-step>
          </clr-timeline>
        </div>
      </div>
    </div>
  </div>
  <div [class]="layout.block2">

    <!--STEP 0-->
    <div class="card" *ngIf="timelineStyle.step0.open">
      <div class="card-header">
        <h3 style="text-align: center;" *ngIf="!appToUpdate">{{tableName}} Table</h3>
        <h3 style="text-align: center;" *ngIf="appToUpdate"> Update {{college.studentname}}</h3>
        <div class="container">

          <br />

          <!-- entry form-->
          <form #contactForm="ngForm" (ngSubmit)="onSave()">
            <div class="container">
              <!-- <div class="clr-row">
              <div class="horizontal1">
                  <label for="tags"> Student Name<span class="required-field">*</span></label>
                  <input id="name" type="text"  placeholder="Enter name" name="name"  required>
               </div>

              <div class="horizontal1">
                <label for="tags">Department<span class="required-field">*</span></label>
                <input id="department" type="text"  placeholder="Enter department" name="department"  required>
              </div>
              <div class="horizontal1">
                <label for="tags">Phone<span class="required-field">*</span></label>
                <input id="phone" type="text"  placeholder="Enter phone" name="phone"  required>
              </div>
              <div class="horizontal1">
                <label for="tags">EmailId<span class="required-field">*</span></label>
                <input id="emailId" type="text"  placeholder="Enter emailid" name="emailId"  required>

              </div>
            </div> -->

              <!-- end row -->
              <div *ngFor="let sheetName of sheetNames">
                <h3>{{ sheetName }}</h3>
                <div style="max-width:fit-content; overflow-x:auto">
                  <table class="table">
                    <thead>
                      <tr>
                        <th *ngFor="let co of getHeaders(sheetName)">{{ co }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of getData(sheetName)">
                        <td *ngFor="let key of getHeaders(sheetName)">{{ item[key] }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <br>
              <div class="button">
                <!-- <button type="submit" class="btn btn-primary" [disabled]="!contactForm.valid">Submit</button> -->

                <button type="button" class="btn  btn-primary"
                  (click)=" this.timelineStyle.step0 ={ state: 'success', open: false };this.timelineStyle.step1 ={ state: 'current', open: true }; this.getColumns(tableName); getColumnforstep1();">Complete</button>
                <button type="button" class="btn btn-primary"
                  (click)=" this.timelineStyle.step0 ={state:'current',open:false};this.timelineStyle.step1 ={state:'not-started',open:true}">Next</button>

              </div>

            </div>
          </form>
        </div>
        <div class="container">

        </div>

      </div>
    </div>
    <!--STEP 1-->
    <div class="card" *ngIf="timelineStyle.step1.open">
      <div class="card-header">
        <h3 style="text-align: center;" *ngIf="!appToUpdate">Table Mapping</h3>

        <form #contactForm="ngForm">

          <div class="container">
            <div class="clr-row fieldWrapper">
              <div class="clr-col-md-12 clr-col-sm-12">
                <table class="table" style="width:100%;">
                  <thead>
                    <tr>
                      <th>Sheet Name</th>
                      <th>Table Name</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of columnJson; let i = index">
                      <td class="left">
                        <input type="text" [(ngModel)]="data.sheetName" [ngModelOptions]="{standalone: true}"
                          name="sheetName" class="clr-input" readonly />
                      </td>
                      <td>
                        <input type="text" [(ngModel)]="data.TableName" [ngModelOptions]="{standalone: true}"
                          name="TableName" class="clr-input" />
                        <!-- <select [(ngModel)]="data.TableName" [ngModelOptions]="{standalone: true}" name="TableName">
                              <option *ngFor="let data of headerData" [value]="data">{{data}}</option>
                            </select> -->
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- <button type="submit" class="btn btn-primary" >Submit</button> -->

            <button type="button" class="btn  btn-primary"
              (click)="this.timelineStyle.step1 ={ state: 'success', open: false };this.timelineStyle.step2 ={ state: 'current', open: true }; this.getHeadersById(id,sheetNames[0]);  this.rulechecking()">Complete</button>
            <button class="btn btn-primary-outline"
              (click)="this.timelineStyle.step0 ={ state: 'success', open: true };this.timelineStyle.step1 ={ state: 'not-started', open: false };">Back</button>

            <button type="button" class="btn btn-primary"
              (click)="this.timelineStyle.step1 ={state:'not-started',open:false};this.timelineStyle.step2 ={state:'not-started',open:true}">Next</button>

          </div>
        </form>
        <div class="container">
          <div class="clr-col-6">

          </div>
        </div>
        <div class="container">

        </div>
      </div>
    </div>


    <div class="card" *ngIf="timelineStyle.step2.open">
      <div class="card-header">
        <h3 style="text-align: center;" *ngIf="!appToUpdate">Data Mapping</h3>

        <form #contactForm="ngForm">

          <div class="container">
            <div class="clr-row">
              <div class="horizontal1 clr-col-6">
                <div *ngIf="checkTransform">
                  <span class="label label-light-green p7 lbutton" (click)="checkTrans()">Enable TransFormation</span>
                  <!-- <label for="sequence" style="font-weight: bold; cursor: pointer;" (click)="goFromMapper()">Mapper Fields (Transform)&nbsp;&nbsp;<clr-icon shape="pop-out"></clr-icon></label> -->
                  <textarea type="text" style="height:150px; background-color:#d6d6d6;" readonly></textarea>
                </div>
                <div *ngIf="transform">
                  <label for="sequence" style="font-weight: bold;">Mapper Fields <span
                      class="label label-light-green p7 lbutton" (click)="goFromMapper()">OPEN</span><span
                      class="label label-light-green p7 lbutton" (click)="transReset()">RESET</span></label>
                  <textarea type="text" name="mapperText" style="height:150px;" [(ngModel)]="mapperText"
                    readonly></textarea>
                </div>
              </div>

              <div class="horizontal1 clr-col-6">
                <div *ngIf="checkRule"><!--*ngIf="checkRule"-->
                  <div style="text-align: right; width: 100px;"> <span style="cursor: pointer;"
                      class="label label-light-green p7 lbutton" (click)="checkRules()">Add Rule line</span></div>
                  <!-- <label for="sequence" style="font-weight: bold; cursor: pointer;" (click)="goFromMapper()">Mapper Fields (Transform)&nbsp;&nbsp;<clr-icon shape="pop-out"></clr-icon></label> -->
                  <textarea type="text" style="height:150px; background-color:#d6d6d6;" readonly></textarea>
                </div>
                <div *ngIf="Rule">
                  <label for="sequence" style="font-weight: bold;"><span class="label label-light-green p7 lbutton"
                      (click)="goFromRule()">OPEN</span><span class="label label-light-green p7 lbutton"
                      (click)="resetRule()">RESET</span></label>
                  <textarea type="text" name="RuleData" style="height:150px;" [(ngModel)]="RuleData"
                    readonly></textarea>
                </div>
              </div>
            </div>
            <!-- <button type="submit" class="btn btn-primary" >Submit</button> -->

            <button type="button" class="btn  btn-primary"
              (click)="this.timelineStyle.step2 ={ state: 'success', open: false };this.timelineStyle.step3 ={ state: 'current', open: true }; ">Complete</button>
            <button class="btn btn-primary-outline"
              (click)="this.timelineStyle.step1 ={ state: 'success', open: true };this.timelineStyle.step2 ={ state: 'not-started', open: false };">Back</button>

            <button type="button" class="btn btn-primary"
              (click)="this.timelineStyle.step2 ={state:'not-started',open:false};this.timelineStyle.step3 ={state:'not-started',open:true}">Next</button>

          </div>
        </form>
        <div class="container">
          <div class="clr-col-6">

          </div>
        </div>
        <div class="container">

        </div>
      </div>
    </div>

    <!--STEP 2-->
    <div class="card" *ngIf="timelineStyle.step3.open">
      <div class="card-header">
        <h3 style="text-align: center;">Importing Data</h3>
        <!-- <h3 style="text-align: center;" *ngIf="appToUpdate"> Update {{college.studentname}}</h3> -->
        <div class="container">
          <div class="clr-row">
            <div class="container">
              <div class="container" *ngIf="keychangeTable">
                <!-- <table class="table">
              <thead>
                <tr>
                  <th *ngFor="let co of getHeaderskeychange();let i=index">{{co}}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of changeKeyJson">
                  <td *ngFor="let key of getHeaderskeychange()">{{item[key]}}</td>
                </tr>
              </tbody>
            </table> -->

                <div *ngFor="let sheetName of sheetNames">
                  <h3>{{ sheetName }}</h3>
                  <div style="max-width:1200px; overflow-x:auto ">
                    <table class="table">
                      <thead>
                        <tr>
                          <th *ngFor="let co of getHeaderskeychange(sheetName)">{{ co }}</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of getkeychangeData(sheetName)">
                          <td *ngFor="let key of getHeaderskeychange(sheetName)">{{ item[key] }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- <div class="clr-row">
            <div class="horizontal1">
                <label for="tags"> Select Table:<span class="required-field">*</span></label><br>
    
        <select name="singleSelect" ng-model="data.singleSelect" (change)="selectTable($event.target.value)">
          <option value="null">Select Table</option>
          <option value="table1">table1</option>
          <option value="table2">table2</option>
          <option value="table3">table3</option>
          <option value="table4">table4</option>
          <option value="table5">table5</option>
        </select><br>
             </div>
      </div> -->

              <button type="button" class="btn  btn-primary"
                (click)="this.timelineStyle.step3 ={ state: 'success', open: false };this.timelineStyle.step4 ={ state: 'current', open: true }; this.downloadExcel(id);">Complete</button>
              <button class="btn btn-primary-outline"
                (click)="this.timelineStyle.step2 ={ state: 'success', open: true };this.timelineStyle.step3 ={ state: 'not-started', open: false };">Back</button>

              <button type="button" class="btn btn-primary"
                (click)="this.timelineStyle.step3 ={state:'not-started',open:false};this.timelineStyle.step4 ={state:'not-started',open:true}">Next</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!--STEP 3-->
    <div class="card" *ngIf="timelineStyle.step4.open;">
      <div class="card-header">
        <h3 style="text-align: center;" *ngIf="!appToUpdate">Download Excel</h3>
        <div class="clr-row">
        </div>
        <div class="container">
          <button type="button" class="btn  btn-primary"
            (click)="this.timelineStyle.step4 ={ state: 'success', open: false };this.timelineStyle.step5 ={ state: 'current', open: true };  ">Complete</button>
          <button class="btn btn-primary-outline"
            (click)="this.timelineStyle.step3 ={ state: 'success', open: true };this.timelineStyle.step4 ={ state: 'not-started', open: false };">Back</button>

          <button type="button" class="btn btn-primary"
            (click)="this.timelineStyle.step4 ={state:'not-started',open:false};this.timelineStyle.step5 ={state:'not-started',open:true}">Next</button>
        </div>
      </div>
    </div>
    <!--STEP 4-->
    <div class="card" *ngIf="timelineStyle.step5.open">
      <div class="card-header">
        <h3 style="text-align: center;" *ngIf="!appToUpdate">File is Downloaded</h3>
        <div class="container">
          <button class="btn btn-primary-outline"
            (click)="this.timelineStyle.step4 ={ state: 'current', open: true };this.timelineStyle.step5 ={ state: 'not-started', open: false };">Back</button>
          <button class="btn btn-primary"
            (click)="this.timelineStyle.step5 ={ state: 'success', open: false }; this.back()"> Finish</button>

        </div>
      </div>
    </div>


  </div>

  <clr-modal [(clrModalOpen)]="mappperModal" [clrModalSize]="'xl'" [clrModalStaticBackdrop]="true">
    <h3 class="modal-title"> MAPPER FORM</h3>
    <div class="modal-body">
      <form>
        <div class="clr-row" style="padding-left: 10px;">
          <div *ngFor="let sheetName of sheetNames">
            <button class="btn btn-primary" (click)="getHeaderbybutton(id,sheetName)">{{sheetName}}</button>
          </div>
          <!-- <button class="btn btn-primary" (click)="checkData()">Check data</button> -->
        </div>
        <div class="clr-row fieldWrapper">
          <div class="clr-col-md-12 clr-col-sm-12">
            <table class="table" style="width:100%;" *ngIf="selectedSheetName">
              <thead>
                <tr>
                  <th>Header Fields</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of JsonHeader[selectedSheetName]; let i = index">
                  <td class="left">
                    <input type="text" [(ngModel)]="data.headerName" [ngModelOptions]="{standalone: true}"
                      name="headerName" class="clr-input" readonly />
                  </td>
                  <td>
                    <!-- <input type="text"  [(ngModel)]="data.value" [ngModelOptions]="{standalone: true}" name="value" class="clr-input"/> -->
                    <select [(ngModel)]="data.value" [ngModelOptions]="{standalone: true}" name="value">
                      <option value="null">choose {{selectedSheetName}}</option>
                      <option *ngFor="let data of headerData" [value]="data">{{data}}</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>


        </div>
        <br>
        <div class="modal-footer">
          <button type="button" form-control class="btn btn-outline" (click)="mappperModal = false">Back</button>
          <button type="submit" form-control class="btn btn-primary" (click)="onUpdate()">SUBMIT</button>
        </div>
      </form>
    </div>
  </clr-modal>

  <clr-modal [(clrModalOpen)]="ruleModal" [clrModalSize]="'xl'" [clrModalStaticBackdrop]="true">
    <h3 class="modal-title">Add Rule Lines</h3>
    <div class="modal-body">
      <form>
        <div class="clr-row fieldWrapper">
          <div class="clr-col-12">
            <table class="table table-striped table-bordered" style="margin-top: 0px;">
              <thead>
                <tr>
                  <th>Rule Name</th>
                  <th>From Sheet</th>
                  <th>From Column</th>
                  <th>validation Table</th>
                  <th>Check Column</th>
                  <th>Use Column (Id)</th>
                  <th>Replacement Table (Id)</th>
                  <th>Replacement Column (Id)</th>
                  <th>Error Message</th>
                  <th class="right" style="width:90px;">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of RuleHeader; let i = index">
                  <td>
                    <input type="text" [(ngModel)]="data.rulename" [ngModelOptions]="{standalone: true}" name="rulename"
                      class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.fromsheet" [ngModelOptions]="{standalone: true}"
                      name="fromsheet" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.fromColumn" [ngModelOptions]="{standalone: true}"
                      name="fromcolomn" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.validationTable" [ngModelOptions]="{standalone: true}"
                      name="validationtable" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.checkColumn" [ngModelOptions]="{standalone: true}"
                      name="checkcolumn" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.useColumn" [ngModelOptions]="{standalone: true}"
                      name="useColumn" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.replacementTable" [ngModelOptions]="{standalone: true}"
                      name="replacementTable" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.replacementcolumn" [ngModelOptions]="{standalone: true}"
                      name="replacementcolumn" class="clr-input">
                  </td>
                  <td>
                    <input type="text" [(ngModel)]="data.errormsg" [ngModelOptions]="{standalone: true}" name="errormsg"
                      class="clr-input">
                  </td>
                  <td style="width:40px;">
                    <a (click)="deleteRow(i)">
                      <clr-icon shape="trash" class="is-error"></clr-icon>
                    </a>
                  </td>
                </tr>

              </tbody>
              <button type="button" class="btn btn-primary button1" style="margin-left: 10px;" (click)="onAddLines()">
                <clr-icon shape="plus"></clr-icon>
              </button>
            </table>
          </div>
        </div>
        <br>
        <div class="modal-footer">
          <button type="button" form-control class="btn btn-outline" (click)="ruleModal = false">Back</button>
          <button type="submit" form-control class="btn btn-primary" (click)="onRuleUpdate()">SUBMIT</button>
        </div>
      </form>
    </div>
  </clr-modal>